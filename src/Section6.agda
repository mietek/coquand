module Section6 where

open import Section5 public


-- 6. Application to terms
-- =======================

-- 6.1. Definition of terms
-- ------------------------

mutual
  data Tm : Set where
    Î½   : Name â†’ Tm
    Æ›   : Name â†’ Tm â†’ Tm
    _âˆ™_ : Tm â†’ Tm â†’ Tm
    _â–¶_ : Tm â†’ Sub â†’ Tm

  data Sub : Set where
    []      : Sub
    _â—_     : Sub â†’ Sub â†’ Sub
    [_,_â‰”_] : Sub â†’ Name â†’ Tm â†’ Sub


-- 6.2. Typing rules
-- -----------------

mutual
  infix 3 _âŠ¢_âˆ·_
  data _âŠ¢_âˆ·_ : ğ’ â†’ Tm â†’ ğ’¯ â†’ Set where
    Î½        : âˆ€ {Î“ A} â†’
                 (x : Name) â†’ Î“ âˆ‹ x âˆ· A â†’
                 Î“ âŠ¢ Î½ x âˆ· A
    Æ›        : âˆ€ {Î“ t A B} â†’
                 (x : Name) {{_ : T (fresh x Î“)}} â†’ [ Î“ , x âˆ· A ] âŠ¢ t âˆ· B â†’
                 Î“ âŠ¢ Æ› x t âˆ· A âŠƒ B
    _âˆ™_      : âˆ€ {Î“ t u A B} â†’
                 Î“ âŠ¢ t âˆ· A âŠƒ B â†’ Î“ âŠ¢ u âˆ· A â†’
                 Î“ âŠ¢ t âˆ™ u âˆ· B
    _â–¶_      : âˆ€ {Î“ Î“â€² s t A} â†’
                 Î“ âŠ¢ t âˆ· A â†’ Î“â€² â‹™ s âˆ· Î“ â†’
                 Î“â€² âŠ¢ t â–¶ s âˆ· A
    âŠ¢âˆ·-â†‘âŸ¨_âŸ© : âˆ€ {Î“ Î“â€² t A} â†’
                 Î“â€² âŠ‡ Î“ â†’ Î“ âŠ¢ t âˆ· A â†’
                 Î“â€² âŠ¢ t âˆ· A

  infix 3 _â‹™_âˆ·_
  data _â‹™_âˆ·_ : ğ’ â†’ Sub â†’ ğ’ â†’ Set where
    refl      : âˆ€ {Î“} â†’
                  Î“ â‹™ [] âˆ· Î“
    _â—_       : âˆ€ {Î“ Î“â€² Î“â€³ s sâ€²} â†’
                  Î“â€² â‹™ s âˆ· Î“ â†’ Î“â€³ â‹™ sâ€² âˆ· Î“â€² â†’
                  Î“â€³ â‹™ s â— sâ€² âˆ· Î“
    [_,_â‰”_]   : âˆ€ {Î“ Î“â€² s t A} â†’
                  Î“â€² â‹™ s âˆ· Î“ â†’ (x : Name) {{_ : T (fresh x Î“)}} â†’ Î“â€² âŠ¢ t âˆ· A â†’
                  Î“â€² â‹™ [ s , x â‰” t ] âˆ· [ Î“ , x âˆ· A ]
    â‹™âˆ·-â†‘âŸ¨_âŸ© : âˆ€ {Î“ Î“â€² Î” s} â†’
                  Î“â€² âŠ‡ Î“ â†’ Î“ â‹™ s âˆ· Î” â†’
                  Î“â€² â‹™ s âˆ· Î”
    â‹™âˆ·-â†“âŸ¨_âŸ© : âˆ€ {Î“ Î“â€² Î” s} â†’
                  Î“â€² âŠ‡ Î“ â†’ Î” â‹™ s âˆ· Î“â€² â†’
                  Î” â‹™ s âˆ· Î“

instance
  raise-âŠ¢âˆ· : âˆ€ {t A} â†’ Raiseable (_âŠ¢ t âˆ· A)
  raise-âŠ¢âˆ· = record { â†‘âŸ¨_âŸ© = âŠ¢âˆ·-â†‘âŸ¨_âŸ© }

  raise-â‹™âˆ· : âˆ€ {Î“ s} â†’ Raiseable (_â‹™ s âˆ· Î“)
  raise-â‹™âˆ· = record { â†‘âŸ¨_âŸ© = â‹™âˆ·-â†‘âŸ¨_âŸ© }

  lower-â‹™âˆ· : âˆ€ {Î” s} â†’ Lowerable (Î” â‹™ s âˆ·_)
  lower-â‹™âˆ· = record { â†“âŸ¨_âŸ© = â‹™âˆ·-â†“âŸ¨_âŸ© }


-- 6.3. Convertibility of terms
-- ----------------------------

mutual
  infix 3 _âŠ¢_â‰Š_âˆ·_
  data _âŠ¢_â‰Š_âˆ·_ : ğ’ â†’ Tm â†’ Tm â†’ ğ’¯ â†’ Set where
    â‰Š-refl  : âˆ€ {Î“ A t} â†’
                Î“ âŠ¢ t â‰Š t âˆ· A
    â‰Š-sym   : âˆ€ {Î“ A t tâ€²} â†’
                Î“ âŠ¢ t â‰Š tâ€² âˆ· A â†’
                Î“ âŠ¢ tâ€² â‰Š t âˆ· A
    â‰Š-trans : âˆ€ {Î“ A t tâ€² tâ€³} â†’
                Î“ âŠ¢ t â‰Š tâ€² âˆ· A â†’ Î“ âŠ¢ tâ€² â‰Š tâ€³ âˆ· A â†’
                Î“ âŠ¢ t â‰Š tâ€³ âˆ· A

    â‰Š-cong-Æ› : âˆ€ {Î“ A B t tâ€² x} {{_ : T (fresh x Î“)}} â†’
                 [ Î“ , x âˆ· A ] âŠ¢ t â‰Š tâ€² âˆ· B â†’
                 Î“ âŠ¢ Æ› x t â‰Š Æ› x tâ€² âˆ· A âŠƒ B
    â‰Š-cong-âˆ™ : âˆ€ {Î“ A B t tâ€² u uâ€²} â†’
                 Î“ âŠ¢ t â‰Š tâ€² âˆ· A âŠƒ B â†’ Î“ âŠ¢ u â‰Š uâ€² âˆ· A â†’
                 Î“ âŠ¢ t âˆ™ u â‰Š tâ€² âˆ™ uâ€² âˆ· B
    â‰Š-cong-â–¶ : âˆ€ {Î“ Î“â€² A t tâ€² s sâ€²} â†’
                 Î“ âŠ¢ t â‰Š tâ€² âˆ· A â†’ Î“â€² â‹™ s â‰Šâ‹† sâ€² âˆ· Î“ â†’
                 Î“ âŠ¢ t â–¶ s â‰Š tâ€² â–¶ sâ€² âˆ· A

    â‰Š-convâ‚ : âˆ€ {Î“ A t} â†’
                Î“ âŠ¢ t âˆ· A â†’
                Î“ âŠ¢ t â‰Š t âˆ· A
    â‰Š-convâ‚‚ : âˆ€ {Î“ Î“â€² A B s t u x} {{_ : T (fresh x Î“)}} â†’
                Î“â€² â‹™ s âˆ· Î“ â†’ [ Î“ , x âˆ· A ] âŠ¢ t âˆ· B â†’ Î“â€² âŠ¢ u âˆ· A â†’
                Î“â€² âŠ¢ (Æ› x t â–¶ s) âˆ™ u â‰Š t â–¶ [ s , x â‰” u ] âˆ· B
    â‰Š-convâ‚ƒ : âˆ€ {Î“ A B t x} {{_ : T (fresh x Î“)}} â†’
                Î“ âŠ¢ t âˆ· A âŠƒ B â†’
                Î“ âŠ¢ t â‰Š Æ› x (t âˆ™ Î½ x) âˆ· A âŠƒ B
    â‰Š-convâ‚„ : âˆ€ {Î“ Î“â€² A t tâ€²} â†’
                Î“â€² âŠ‡ Î“ â†’ Î“ âŠ¢ t â‰Š tâ€² âˆ· A â†’
                Î“â€² âŠ¢ t â‰Š tâ€² âˆ· A
    â‰Š-convâ‚… : âˆ€ {Î“ Î“â€² A s t x} {{_ : T (fresh x Î“)}} â†’
                Î“â€² â‹™ s âˆ· Î“ â†’ Î“â€² âŠ¢ t âˆ· A â†’
                Î“â€² âŠ¢ Î½ x â–¶ [ s , x â‰” t ] â‰Š t âˆ· A
    â‰Š-convâ‚† : âˆ€ {Î“ A t} â†’
                Î“ âŠ¢ t âˆ· A â†’
                Î“ âŠ¢ t â–¶ [] â‰Š t âˆ· A
    â‰Š-convâ‚‡ : âˆ€ {Î“ Î“â€² A B s t u} â†’
                Î“ âŠ¢ t âˆ· A âŠƒ B â†’ Î“ âŠ¢ u âˆ· A â†’ Î“â€² â‹™ s âˆ· Î“ â†’
                Î“â€² âŠ¢ (t âˆ™ u) â–¶ s â‰Š (t â–¶ s) âˆ™ (u â–¶ s) âˆ· B
    â‰Š-convâ‚ˆ : âˆ€ {Î“ Î“â€² Î“â€³ A s sâ€² t} â†’
                Î“â€² â‹™ s âˆ· Î“ â†’ Î“â€³ â‹™ sâ€² âˆ· Î“â€² â†’ Î“ âŠ¢ t âˆ· A â†’
                Î“â€³ âŠ¢ (t â–¶ s) â–¶ sâ€² â‰Š t â–¶ (s â— sâ€²) âˆ· A

  data _â‹™_â‰Šâ‹†_âˆ·_ : ğ’ â†’ Sub â†’ Sub â†’ ğ’ â†’ Set where
    â‰Šâ‹†-refl  : âˆ€ {Î“ Î“â€² s} â†’
                 Î“â€² â‹™ s â‰Šâ‹† s âˆ· Î“
    â‰Šâ‹†-sym   : âˆ€ {Î“ Î“â€² s sâ€²} â†’
                 Î“â€² â‹™ s â‰Šâ‹† sâ€² âˆ· Î“ â†’
                 Î“â€² â‹™ sâ€² â‰Šâ‹† s âˆ· Î“
    â‰Šâ‹†-trans : âˆ€ {Î“ Î“â€² s sâ€² sâ€³} â†’
                 Î“â€² â‹™ s â‰Šâ‹† sâ€² âˆ· Î“ â†’ Î“â€² â‹™ sâ€² â‰Šâ‹† sâ€³ âˆ· Î“ â†’
                 Î“â€² â‹™ s â‰Šâ‹† sâ€³ âˆ· Î“

    -- TODO: cong, conv
